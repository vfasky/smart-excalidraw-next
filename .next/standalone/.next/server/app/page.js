(()=>{var a={};a.id=974,a.ids=[974],a.modules={61:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"default",{enumerable:!0,get:function(){return j}});let d=c(8249),e=c(7484),f=c(6958),g=c(5264);function h(a){return{default:a&&"default"in a?a.default:a}}let i={loader:()=>Promise.resolve(h(()=>null)),loading:null,ssr:!0},j=function(a){let b={...i,...a},c=(0,e.lazy)(()=>b.loader().then(h)),j=b.loading;function k(a){let h=j?(0,d.jsx)(j,{isLoading:!0,pastDelay:!0,error:null}):null,i=!b.ssr||!!b.loading,k=i?e.Suspense:e.Fragment,l=b.ssr?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(g.PreloadChunks,{moduleIds:b.modules}),(0,d.jsx)(c,{...a})]}):(0,d.jsx)(f.BailoutToCSR,{reason:"next/dynamic",children:(0,d.jsx)(c,{...a})});return(0,d.jsx)(k,{...i?{fallback:h}:{},children:l})}return k.displayName="LoadableComponent",k}},117:(a,b)=>{"use strict";function c(a){return a.split("/").map(a=>encodeURIComponent(a)).join("/")}Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"encodeURIPath",{enumerable:!0,get:function(){return c}})},261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},722:a=>{"use strict";a.exports=require("next/dist/shared/lib/invariant-error")},846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1025:a=>{"use strict";a.exports=require("next/dist/server/app-render/dynamic-access-async-storage.external.js")},2123:a=>{a.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_188709",variable:"__variable_188709"}},2704:()=>{},3033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:a=>{"use strict";a.exports=require("path")},3954:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/interception-routes")},4607:a=>{a.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_9a8899",variable:"__variable_9a8899"}},5091:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"default",{enumerable:!0,get:function(){return f}});let d=c(5735),e=c(2675);function f(){return(0,d.jsx)(e.HTTPAccessErrorFallback,{status:404,message:"This page could not be found."})}("function"==typeof b.default||"object"==typeof b.default&&null!==b.default)&&void 0===b.default.__esModule&&(Object.defineProperty(b.default,"__esModule",{value:!0}),Object.assign(b.default,b),a.exports=b.default)},5151:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>d});let d=(0,c(7943).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/rongfahuang/flyapp/smart-excalidraw-next/app/page.js\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/rongfahuang/flyapp/smart-excalidraw-next/app/page.js","default")},5264:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"PreloadChunks",{enumerable:!0,get:function(){return h}});let d=c(8249),e=c(4429),f=c(9294),g=c(117);function h({moduleIds:a}){let b=f.workAsyncStorage.getStore();if(void 0===b)return null;let c=[];if(b.reactLoadableManifest&&a){let d=b.reactLoadableManifest;for(let b of a){if(!d[b])continue;let a=d[b].files;c.push(...a)}}return 0===c.length?null:(0,d.jsx)(d.Fragment,{children:c.map(a=>{let c=`${b.assetPrefix}/_next/${(0,g.encodeURIPath)(a)}`;return a.endsWith(".css")?(0,d.jsx)("link",{precedence:"dynamic",href:c,rel:"stylesheet",as:"style",nonce:b.nonce},a):((0,e.preload)(c,{as:"script",fetchPriority:"low",nonce:b.nonce}),null)})})}},5396:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,1921,23)),Promise.resolve().then(c.t.bind(c,440,23)),Promise.resolve().then(c.t.bind(c,4342,23)),Promise.resolve().then(c.t.bind(c,2265,23)),Promise.resolve().then(c.t.bind(c,5421,23)),Promise.resolve().then(c.t.bind(c,1335,23)),Promise.resolve().then(c.t.bind(c,664,23)),Promise.resolve().then(c.bind(c,4661))},5540:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,5547,23)),Promise.resolve().then(c.t.bind(c,5098,23)),Promise.resolve().then(c.t.bind(c,7644,23)),Promise.resolve().then(c.t.bind(c,3859,23)),Promise.resolve().then(c.t.bind(c,8099,23)),Promise.resolve().then(c.t.bind(c,6237,23)),Promise.resolve().then(c.t.bind(c,8562,23)),Promise.resolve().then(c.t.bind(c,6675,23))},5708:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>ay});var d,e,f=c(8249),g=c(7484),h=c(9973),i=c.n(h);let j={"image/jpeg":"jpg","image/jpg":"jpg","image/png":"png","image/webp":"webp","image/gif":"gif"};function k(a){return Object.keys(j).includes(a.type)?a.size>5242880?{isValid:!1,error:`图片大小不能超过 ${Math.round(5)}MB`}:{isValid:!0}:{isValid:!1,error:`不支持的图片格式。支持的格式：${Object.values(j).join(", ")}`}}async function l(a){let b=k(a);if(!b.isValid)throw Error(b.error);try{let[b,c]=await Promise.all([new Promise((b,c)=>{let d=new FileReader;d.onload=()=>{b(d.result.split(",")[1])},d.onerror=()=>{c(Error("图片读取失败"))},d.readAsDataURL(a)}),new Promise((b,c)=>{let d=new Image,e=URL.createObjectURL(a);d.onload=()=>{let a={width:d.width,height:d.height};URL.revokeObjectURL(e),b(a)},d.onerror=()=>{URL.revokeObjectURL(e),c(Error("无法读取图片尺寸"))},d.src=e})]);return{data:b,mimeType:a.type,dimensions:c,size:a.size,name:a.name}}catch(a){throw Error(`图片处理失败: ${a.message}`)}}let m={auto:"自动",flowchart:"流程图",mindmap:"思维导图",orgchart:"组织架构图",sequence:"时序图",class:"UML类图",er:"ER图",gantt:"甘特图",timeline:"时间线",tree:"树形图",network:"网络拓扑图",architecture:"架构图",dataflow:"数据流图",state:"状态图",swimlane:"泳道图",concept:"概念图",fishbone:"鱼骨图",swot:"SWOT分析图",pyramid:"金字塔图",funnel:"漏斗图",venn:"韦恩图",matrix:"矩阵图",infographic:"信息图"};function n({onImageSelect:a,isGenerating:b,chartType:c,onChartTypeChange:d,onImageGenerate:e}){let[h,i]=(0,g.useState)(null),[j,n]=(0,g.useState)(null),[o,p]=(0,g.useState)(""),[q,r]=(0,g.useState)(""),[s,t]=(0,g.useState)(!1),u=(0,g.useRef)(null),v=(0,g.useRef)(0),w=async b=>{if(b){p("uploading"),r("");try{let c=k(b);if(!c.isValid)throw Error(c.error);let d=await new Promise((a,c)=>{let d=new FileReader;d.onload=()=>{a(d.result)},d.onerror=()=>{c(Error("图片预览失败"))},d.readAsDataURL(b)});i(d),n(b);let e=await l(b);p("success"),a&&a({...e,previewUrl:d,file:b})}catch(a){p("error"),r(a.message),console.error("图片处理失败:",a)}}};return(0,f.jsxs)("div",{className:"flex-1 flex flex-col p-4",children:[(0,f.jsx)("div",{className:"w-full mb-4",children:(0,f.jsx)("select",{id:"chart-type-image",value:c,onChange:a=>d?.(a.target.value),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-900 bg-white",disabled:b||"uploading"===o,children:Object.entries(m).map(([a,b])=>(0,f.jsx)("option",{value:a,children:b},a))})}),j?(0,f.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,f.jsxs)("div",{className:"flex-1 flex justify-center relative bg-gray-50 rounded-lg overflow-hidden border border-gray-200",children:[h&&(0,f.jsx)("img",{src:h,alt:"预览",className:"w-full object-contain"}),(0,f.jsx)("button",{onClick:()=>{i(null),n(null),p(""),r(""),u.current&&(u.current.value=""),a&&a(null)},disabled:b||"uploading"===o,className:"absolute top-3 right-3 p-2 bg-white rounded-full shadow-md hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",title:"删除图片",children:(0,f.jsx)("svg",{className:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),"success"===o&&(0,f.jsx)("div",{className:"absolute top-3 left-3",children:(0,f.jsx)("div",{className:"w-6 h-6 bg-green-600 rounded-full flex items-center justify-center",children:(0,f.jsx)("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})}),"uploading"===o&&(0,f.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white/75",children:(0,f.jsx)("div",{className:"w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"})}),j&&(0,f.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-3",children:(0,f.jsx)("p",{className:"text-xs font-medium text-white mb-1 truncate",title:j.name,children:j.name})})]}),q&&(0,f.jsx)("div",{className:"mt-2 p-2 bg-red-50 border border-red-200 rounded",children:(0,f.jsx)("p",{className:"text-xs text-red-600",children:q})}),"success"===o&&!b&&(0,f.jsxs)("button",{onClick:e,className:"w-full mt-2 px-4 py-3 bg-gray-900 text-white rounded hover:bg-gray-800 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center space-x-2",children:[(0,f.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),(0,f.jsx)("span",{children:"开始生成"})]}),b&&"success"===o&&(0,f.jsxs)("div",{className:"mt-2 flex items-center justify-center text-sm text-blue-600",children:[(0,f.jsxs)("div",{className:"flex space-x-1 mr-2",children:[(0,f.jsx)("div",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,f.jsx)("div",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,f.jsx)("div",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),(0,f.jsx)("span",{children:"正在识别..."})]})]}):(0,f.jsxs)("div",{className:`flex-1 flex flex-col items-center justify-center border-2 border-dashed rounded-lg transition-colors duration-200 ${s?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:a=>{a.preventDefault(),a.stopPropagation(),v.current++,a.dataTransfer.items&&a.dataTransfer.items.length>0&&t(!0)},onDragLeave:a=>{a.preventDefault(),a.stopPropagation(),v.current--,0===v.current&&t(!1)},onDragOver:a=>{a.preventDefault(),a.stopPropagation()},onDrop:a=>{a.preventDefault(),a.stopPropagation(),t(!1),v.current=0;let b=a.dataTransfer.files;b&&b.length>0&&w(b[0])},children:[(0,f.jsxs)("div",{className:"text-center mb-4",children:[(0,f.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400 mb-3",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:(0,f.jsx)("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),(0,f.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"上传图片进行识别"}),(0,f.jsx)("p",{className:"text-xs text-gray-400",children:"支持 JPG、PNG、WebP、GIF 格式，最大 5MB"})]}),(0,f.jsx)("input",{ref:u,type:"file",accept:"image/*",onChange:a=>{let b=a.target.files?.[0];b&&w(b)},className:"hidden",disabled:b||"uploading"===o}),(0,f.jsx)("button",{onClick:()=>{b||"uploading"===o||u.current?.click()},disabled:b||"uploading"===o,className:"px-6 py-2 bg-gray-900 text-white text-sm rounded hover:bg-gray-800 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors duration-200 flex items-center space-x-2",children:"uploading"===o?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,f.jsx)("span",{children:"处理中..."})]}):b?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,f.jsx)("span",{children:"生成中..."})]}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,f.jsx)("span",{children:"选择图片"})]})}),s&&(0,f.jsx)("p",{className:"mt-3 text-sm text-blue-600",children:"松开鼠标上传图片"})]})]})}function o({isVisible:a,message:b="处理中...",transparent:c=!1,className:d=""}){return a?(0,f.jsx)("div",{className:`absolute inset-0 z-50 flex items-center justify-center ${c?"bg-black/10 ":"bg-white/90 "} ${d}`,children:(0,f.jsxs)("div",{className:"flex flex-col items-center space-y-3",children:[(0,f.jsx)("div",{className:"relative",children:(0,f.jsx)("div",{className:"w-8 h-8 border-2 border-gray-300 border-t-gray-900 rounded-full animate-spin"})}),(0,f.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,f.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:b}),(0,f.jsxs)("div",{className:"flex space-x-1",children:[(0,f.jsx)("div",{className:"w-1.5 h-1.5 bg-gray-700 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,f.jsx)("div",{className:"w-1.5 h-1.5 bg-gray-700 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,f.jsx)("div",{className:"w-1.5 h-1.5 bg-gray-700 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]})]})}):null}function p({onSendMessage:a,isGenerating:b,initialInput:c="",initialChartType:d="auto"}){let[e,h]=(0,g.useState)("text"),[i,j]=(0,g.useState)(c),[k,l]=(0,g.useState)(d),[p,q]=(0,g.useState)(null),[r,s]=(0,g.useState)(""),[t,u]=(0,g.useState)(""),[v,w]=(0,g.useState)(null),[x,y]=(0,g.useState)(""),[z,A]=(0,g.useState)(!1),B=(0,g.useRef)(null),C=(0,g.useRef)(null),D=c=>{c.preventDefault(),i.trim()&&!b&&a(i.trim(),k)};return(0,f.jsxs)("div",{className:"flex flex-col h-full bg-white",children:[(0,f.jsxs)("div",{className:"flex border-b border-gray-200 bg-gray-50",children:[(0,f.jsx)("button",{onClick:()=>{h("text"),A(!1)},className:`flex-1 px-4 py-3 text-sm font-medium transition-colors duration-200 ${"text"===e?"bg-white text-gray-900 border-b-2 border-gray-900":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:"文本输入"}),(0,f.jsx)("button",{onClick:()=>{h("file"),A(!!x)},className:`flex-1 px-4 py-3 text-sm font-medium transition-colors duration-200 ${"file"===e?"bg-white text-gray-900 border-b-2 border-gray-900":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:"文件上传"}),(0,f.jsx)("button",{onClick:()=>{h("image"),A(!!v)},className:`flex-1 px-4 py-3 text-sm font-medium transition-colors duration-200 ${"image"===e?"bg-white text-gray-900 border-b-2 border-gray-900":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:"图片上传"})]}),(0,f.jsxs)("div",{className:"flex-1 flex flex-col",children:["text"===e&&(0,f.jsxs)("div",{className:"flex-1 flex flex-col p-4 relative",children:[(0,f.jsxs)("form",{onSubmit:D,className:"flex-1 flex flex-col",children:[(0,f.jsx)("div",{className:"mb-3",children:(0,f.jsx)("select",{id:"chart-type-text",value:k,onChange:a=>l(a.target.value),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-900 bg-white",disabled:b,children:Object.entries(m).map(([a,b])=>(0,f.jsx)("option",{value:a,children:b},a))})}),(0,f.jsxs)("div",{className:"relative flex-1",children:[(0,f.jsx)("textarea",{ref:B,value:i,onChange:a=>j(a.target.value),onKeyDown:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),D(a))},placeholder:"描述您想要创建的图表...",className:"w-full h-full pl-3 pr-12 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-900 resize-none text-sm scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},disabled:b}),(0,f.jsx)("button",{type:"submit",disabled:!i.trim()||b,className:"absolute right-2 bottom-2 p-2 bg-gray-900 text-white rounded hover:bg-gray-800 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors duration-200",title:b?"生成中...":"发送",children:b?(0,f.jsx)("div",{className:"flex items-center justify-center",children:(0,f.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"})}):(0,f.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})]}),(0,f.jsx)(o,{isVisible:b,message:"正在生成图表..."})]}),"file"===e&&(0,f.jsxs)("div",{className:"flex-1 flex flex-col items-center  p-4 relative",children:[(0,f.jsx)("div",{className:"w-full max-w-md mb-6",children:(0,f.jsx)("select",{id:"chart-type-file",value:k,onChange:a=>l(a.target.value),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-900 bg-white",disabled:b||"parsing"===r,children:Object.entries(m).map(([a,b])=>(0,f.jsx)("option",{value:a,children:b},a))})}),(0,f.jsxs)("div",{className:"text-center mb-6",children:[(0,f.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"上传 Markdown 或文本文件"}),(0,f.jsx)("p",{className:"text-xs text-gray-400",children:"支持 .md 和 .txt 格式，最大 1MB"})]}),(0,f.jsx)("input",{ref:C,type:"file",accept:".md,.txt",onChange:a=>{let b=a.target.files?.[0];if(!b){q(null),s(""),u(""),y(""),A(!1);return}if(![".md",".txt"].includes(b.name.substring(b.name.lastIndexOf(".")).toLowerCase())){u("请选择 .md 或 .txt 文件"),s("error"),A(!1);return}if(b.size>1048576){u("文件大小不能超过 1MB"),s("error"),A(!1);return}q(b),s("parsing"),u(""),y(""),A(!1);let c=new FileReader;c.onload=a=>{let b=a.target?.result;"string"==typeof b&&b.trim()?(s("success"),y(b.trim()),A(!0)):(u("文件内容为空"),s("error"),A(!1))},c.onerror=()=>{u("文件读取失败"),s("error"),A(!1)},c.readAsText(b)},className:"hidden",disabled:b||"parsing"===r}),(0,f.jsxs)("button",{onClick:()=>{C.current?.click()},disabled:b||"parsing"===r,className:"px-6 py-3 bg-gray-900 text-white rounded hover:bg-gray-800 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors duration-200 flex items-center space-x-2",children:[b||"parsing"===r?(0,f.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):(0,f.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,f.jsx)("span",{children:"parsing"===r?"解析中...":b?"生成中...":"选择文件"})]}),p&&(0,f.jsxs)("div",{className:"mt-6 w-full max-w-md",children:[(0,f.jsx)("div",{className:`p-4 rounded border ${"success"===r?"bg-green-50 border-green-200":"error"===r?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200"}`,children:(0,f.jsxs)("div",{className:"flex items-center space-x-3",children:["parsing"===r&&(0,f.jsxs)("div",{className:"flex space-x-1",children:[(0,f.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,f.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,f.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),"success"===r&&(0,f.jsx)("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"error"===r&&(0,f.jsx)("svg",{className:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),(0,f.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,f.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:p.name}),"success"===r&&!b&&(0,f.jsx)("p",{className:"text-xs text-green-600 mt-1",children:"文件已上传，可以开始生成"}),"success"===r&&b&&(0,f.jsx)("p",{className:"text-xs text-blue-600 mt-1",children:"正在生成图表..."}),"error"===r&&(0,f.jsx)("p",{className:"text-xs text-red-600 mt-1",children:t}),"parsing"===r&&(0,f.jsx)("p",{className:"text-xs text-blue-600 mt-1",children:"正在解析文件..."})]})]})}),"success"===r&&!b&&(0,f.jsx)("div",{className:"mt-4",children:(0,f.jsxs)("button",{onClick:()=>{x&&!b&&(a(x,k),A(!1))},disabled:!z,className:"w-full px-4 py-3 bg-gray-900 text-white rounded hover:bg-gray-800 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center space-x-2",children:[(0,f.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),(0,f.jsx)("span",{children:"开始生成"})]})})]}),(0,f.jsx)(o,{isVisible:b||"parsing"===r,message:"parsing"===r?"正在解析文件...":"正在生成图表..."})]}),"image"===e&&(0,f.jsxs)("div",{className:"flex-1 flex flex-col relative",children:[(0,f.jsx)(n,{onImageSelect:a=>{w(a),a?A(!0):A(!1)},isGenerating:b,chartType:k,onChartTypeChange:l,onImageGenerate:()=>{if(v&&!b){let b;a({text:(b=k&&"auto"!==k?`请将图片内容转换为${({flowchart:"流程图",mindmap:"思维导图",orgchart:"组织架构图",sequence:"时序图",class:"UML类图",er:"ER图",gantt:"甘特图",timeline:"时间线",tree:"树形图",network:"网络拓扑图",architecture:"架构图",dataflow:"数据流图",state:"状态图",swimlane:"泳道图",concept:"概念图",fishbone:"鱼骨图",swot:"SWOT分析图",pyramid:"金字塔图",funnel:"漏斗图",venn:"韦恩图",matrix:"矩阵图"})[k]||"自动"}类型的Excalidraw图表。`:"请分析图片内容并选择合适的图表类型转换为Excalidraw图表。",`${b}

请仔细分析图片中的：
1. 文字内容和标签
2. 图形元素和结构
3. 流程或连接关系
4. 布局和层次关系
5. 数据或数值信息

基于分析结果，创建清晰、准确的Excalidraw图表，确保：
- 保留图片中的所有关键信息
- 使用合适的图表类型展示内容
- 保持逻辑关系和结构
- 添加必要的文字说明

将图片里的内容转换为excalidraw`),image:v,chartType:k},k),A(!1)}}}),(0,f.jsx)(o,{isVisible:b,message:"正在识别图片内容并生成图表..."})]})]})]})}function q(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function r(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function s(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?r(Object(c),!0).forEach(function(b){var d;d=c[b],b in a?Object.defineProperty(a,b,{value:d,enumerable:!0,configurable:!0,writable:!0}):a[b]=d}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):r(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}function t(a){return function b(){for(var c=this,d=arguments.length,e=Array(d),f=0;f<d;f++)e[f]=arguments[f];return e.length>=a.length?a.apply(this,e):function(){for(var a=arguments.length,d=Array(a),f=0;f<a;f++)d[f]=arguments[f];return b.apply(c,[].concat(e,d))}}}function u(a){return({}).toString.call(a).includes("Object")}function v(a){return"function"==typeof a}var w=t(function(a,b){throw Error(a[b]||a.default)})({initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"}),x=function(a,b){return u(b)||w("changeType"),Object.keys(b).some(function(b){return!Object.prototype.hasOwnProperty.call(a,b)})&&w("changeField"),b},y=function(a){v(a)||w("selectorType")},z=function(a){v(a)||u(a)||w("handlerType"),u(a)&&Object.values(a).some(function(a){return!v(a)})&&w("handlersType")},A=function(a){a||w("initialIsRequired"),u(a)||w("initialType"),Object.keys(a).length||w("initialContent")};function B(a,b){return v(b)?b(a.current):b}function C(a,b){return a.current=s(s({},a.current),b),b}function D(a,b,c){return v(b)?b(a.current):Object.keys(c).forEach(function(c){var d;return null==(d=b[c])?void 0:d.call(b,a.current[c])}),c}var E={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:"Deprecation warning!\n    You are using deprecated way of configuration.\n\n    Instead of using\n      monaco.config({ urls: { monacoBase: '...' } })\n    use\n      monaco.config({ paths: { vs: '...' } })\n\n    For more please check the link https://github.com/suren-atoyan/monaco-loader#config\n  "},F=(d=function(a,b){throw Error(a[b]||a.default)},function a(){for(var b=this,c=arguments.length,e=Array(c),f=0;f<c;f++)e[f]=arguments[f];return e.length>=d.length?d.apply(this,e):function(){for(var c=arguments.length,d=Array(c),f=0;f<c;f++)d[f]=arguments[f];return a.apply(b,[].concat(e,d))}})(E),G=function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return function(a){return b.reduceRight(function(a,b){return b(a)},a)}},H={type:"cancelation",msg:"operation is manually canceled"};function I(a){var b=!1,c=new Promise(function(c,d){a.then(function(a){return b?d(H):c(a)}),a.catch(d)});return c.cancel=function(){return b=!0},c}var J=function(a){if(Array.isArray(a))return a}(e=({create:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};A(a),z(b);var c={current:a},d=t(D)(c,b),e=t(C)(c),f=t(x)(a),g=t(B)(c);return[function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(a){return a};return y(a),a(c.current)},function(a){(function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return function(a){return b.reduceRight(function(a,b){return b(a)},a)}})(d,e,f,g)(a)}]}}).create({config:{paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.54.0/min/vs"}},isInitialized:!1,resolve:null,reject:null,monaco:null}))||function(a,b){var c=null==a?null:"undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(null!=c){var d,e,f,g,h=[],i=!0,j=!1;try{f=(c=c.call(a)).next,!1;for(;!(i=(d=f.call(c)).done)&&(h.push(d.value),2!==h.length);i=!0);}catch(a){j=!0,e=a}finally{try{if(!i&&null!=c.return&&(g=c.return(),Object(g)!==g))return}finally{if(j)throw e}}return h}}(e,2)||function(a,b){if(a){if("string"==typeof a)return q(a,2);var c=({}).toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?q(a,2):void 0}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),K=J[0],L=J[1];function M(a){return document.body.appendChild(a)}function N(a){var b,c,d=K(function(a){return{config:a.config,reject:a.reject}}),e=(b="".concat(d.config.paths.vs,"/loader.js"),c=document.createElement("script"),b&&(c.src=b),c);return e.onload=function(){return a()},e.onerror=d.reject,e}function O(){var a=K(function(a){return{config:a.config,resolve:a.resolve,reject:a.reject}}),b=window.require;b.config(a.config),b(["vs/editor/editor.main"],function(b){var c=b.m;P(c),a.resolve(c)},function(b){a.reject(b)})}function P(a){K().monaco||L({monaco:a})}var Q=new Promise(function(a,b){return L({resolve:a,reject:b})}),R=function(){var a=K(function(a){return{monaco:a.monaco,isInitialized:a.isInitialized,resolve:a.resolve}});if(!a.isInitialized){if(L({isInitialized:!0}),a.monaco)return a.resolve(a.monaco),I(Q);if(window.monaco&&window.monaco.editor)return P(window.monaco),a.resolve(window.monaco),I(Q);G(M,N)(O)}return I(Q)},S={display:"flex",position:"relative",textAlign:"initial"},T={width:"100%"},U={display:"none"},V={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"},W=function({children:a}){return g.createElement("div",{style:V},a)},X=(0,g.memo)(function({width:a,height:b,isEditorReady:c,loading:d,_ref:e,className:f,wrapperProps:h}){return g.createElement("section",{style:{...S,width:a,height:b},...h},!c&&g.createElement(W,null,d),g.createElement("div",{ref:e,style:{...T,...!c&&U},className:f}))}),Y=function(a){(0,g.useEffect)(a,[])},Z=function(a,b,c=!0){let d=(0,g.useRef)(!0);(0,g.useEffect)(d.current||!c?()=>{d.current=!1}:a,b)};function $(){}function _(a,b,c,d){var e,f,g,h,i,j;return e=a,f=d,e.editor.getModel(aa(e,f))||(g=a,h=b,i=c,j=d,g.editor.createModel(h,i,j?aa(g,j):void 0))}function aa(a,b){return a.Uri.parse(b)}(0,g.memo)(function({original:a,modified:b,language:c,originalLanguage:d,modifiedLanguage:e,originalModelPath:f,modifiedModelPath:h,keepCurrentOriginalModel:i=!1,keepCurrentModifiedModel:j=!1,theme:k="light",loading:l="Loading...",options:m={},height:n="100%",width:o="100%",className:p,wrapperProps:q={},beforeMount:r=$,onMount:s=$}){let[t,u]=(0,g.useState)(!1),[v,w]=(0,g.useState)(!0),x=(0,g.useRef)(null),y=(0,g.useRef)(null),z=(0,g.useRef)(null),A=(0,g.useRef)(s),B=(0,g.useRef)(r),C=(0,g.useRef)(!1);Y(()=>{let a=R();return a.then(a=>(y.current=a)&&w(!1)).catch(a=>a?.type!=="cancelation"&&console.error("Monaco initialization: error:",a)),()=>{let b;return x.current?(b=x.current?.getModel(),void(i||b?.original?.dispose(),j||b?.modified?.dispose(),x.current?.dispose())):a.cancel()}}),Z(()=>{if(x.current&&y.current){let b=x.current.getOriginalEditor(),e=_(y.current,a||"",d||c||"text",f||"");e!==b.getModel()&&b.setModel(e)}},[f],t),Z(()=>{if(x.current&&y.current){let a=x.current.getModifiedEditor(),d=_(y.current,b||"",e||c||"text",h||"");d!==a.getModel()&&a.setModel(d)}},[h],t),Z(()=>{let a=x.current.getModifiedEditor();a.getOption(y.current.editor.EditorOption.readOnly)?a.setValue(b||""):b!==a.getValue()&&(a.executeEdits("",[{range:a.getModel().getFullModelRange(),text:b||"",forceMoveMarkers:!0}]),a.pushUndoStop())},[b],t),Z(()=>{x.current?.getModel()?.original.setValue(a||"")},[a],t),Z(()=>{let{original:a,modified:b}=x.current.getModel();y.current.editor.setModelLanguage(a,d||c||"text"),y.current.editor.setModelLanguage(b,e||c||"text")},[c,d,e],t),Z(()=>{y.current?.editor.setTheme(k)},[k],t),Z(()=>{x.current?.updateOptions(m)},[m],t);let D=(0,g.useCallback)(()=>{if(!y.current)return;B.current(y.current);let g=_(y.current,a||"",d||c||"text",f||""),i=_(y.current,b||"",e||c||"text",h||"");x.current?.setModel({original:g,modified:i})},[c,b,e,a,d,f,h]),E=(0,g.useCallback)(()=>{!C.current&&z.current&&(x.current=y.current.editor.createDiffEditor(z.current,{automaticLayout:!0,...m}),D(),y.current?.editor.setTheme(k),u(!0),C.current=!0)},[m,k,D]);return(0,g.useEffect)(()=>{t&&A.current(x.current,y.current)},[t]),(0,g.useEffect)(()=>{v||t||E()},[v,t,E]),g.createElement(X,{width:o,height:n,isEditorReady:t,loading:l,_ref:z,className:p,wrapperProps:q})});var ab=function(a){let b=(0,g.useRef)();return(0,g.useEffect)(()=>{b.current=a},[a]),b.current},ac=new Map,ad=(0,g.memo)(function({defaultValue:a,defaultLanguage:b,defaultPath:c,value:d,language:e,path:f,theme:h="light",line:i,loading:j="Loading...",options:k={},overrideServices:l={},saveViewState:m=!0,keepCurrentModel:n=!1,width:o="100%",height:p="100%",className:q,wrapperProps:r={},beforeMount:s=$,onMount:t=$,onChange:u,onValidate:v=$}){let[w,x]=(0,g.useState)(!1),[y,z]=(0,g.useState)(!0),A=(0,g.useRef)(null),B=(0,g.useRef)(null),C=(0,g.useRef)(null),D=(0,g.useRef)(t),E=(0,g.useRef)(s),F=(0,g.useRef)(),G=(0,g.useRef)(d),H=ab(f),I=(0,g.useRef)(!1),J=(0,g.useRef)(!1);Y(()=>{let a=R();return a.then(a=>(A.current=a)&&z(!1)).catch(a=>a?.type!=="cancelation"&&console.error("Monaco initialization: error:",a)),()=>B.current?void(F.current?.dispose(),n?m&&ac.set(f,B.current.saveViewState()):B.current.getModel()?.dispose(),B.current.dispose()):a.cancel()}),Z(()=>{let g=_(A.current,a||d||"",b||e||"",f||c||"");g!==B.current?.getModel()&&(m&&ac.set(H,B.current?.saveViewState()),B.current?.setModel(g),m&&B.current?.restoreViewState(ac.get(f)))},[f],w),Z(()=>{B.current?.updateOptions(k)},[k],w),Z(()=>{B.current&&void 0!==d&&(B.current.getOption(A.current.editor.EditorOption.readOnly)?B.current.setValue(d):d!==B.current.getValue()&&(J.current=!0,B.current.executeEdits("",[{range:B.current.getModel().getFullModelRange(),text:d,forceMoveMarkers:!0}]),B.current.pushUndoStop(),J.current=!1))},[d],w),Z(()=>{let a=B.current?.getModel();a&&e&&A.current?.editor.setModelLanguage(a,e)},[e],w),Z(()=>{void 0!==i&&B.current?.revealLine(i)},[i],w),Z(()=>{A.current?.editor.setTheme(h)},[h],w);let K=(0,g.useCallback)(()=>{if(!(!C.current||!A.current)&&!I.current){E.current(A.current);let g=f||c,j=_(A.current,d||a||"",b||e||"",g||"");B.current=A.current?.editor.create(C.current,{model:j,automaticLayout:!0,...k},l),m&&B.current.restoreViewState(ac.get(g)),A.current.editor.setTheme(h),void 0!==i&&B.current.revealLine(i),x(!0),I.current=!0}},[a,b,c,d,e,f,k,l,m,h,i]);return(0,g.useEffect)(()=>{w&&D.current(B.current,A.current)},[w]),(0,g.useEffect)(()=>{y||w||K()},[y,w,K]),G.current=d,(0,g.useEffect)(()=>{w&&u&&(F.current?.dispose(),F.current=B.current?.onDidChangeModelContent(a=>{J.current||u(B.current.getValue(),a)}))},[w,u]),(0,g.useEffect)(()=>{if(w){let a=A.current.editor.onDidChangeMarkers(a=>{let b=B.current.getModel()?.uri;if(b&&a.find(a=>a.path===b.path)){let a=A.current.editor.getModelMarkers({resource:b});v?.(a)}});return()=>{a?.dispose()}}return()=>{}},[w,v]),g.createElement(X,{width:o,height:p,isEditorReady:w,loading:j,_ref:C,className:q,wrapperProps:r})});function ae({code:a,onChange:b,onApply:c,onOptimize:d,onClear:e,jsonError:g,onClearJsonError:h,isGenerating:i,isApplyingCode:j,isOptimizingCode:k}){return(0,f.jsxs)("div",{className:"flex relative flex-col h-full bg-gray-50 border-t border-gray-200",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 bg-white border-b border-gray-200",children:[(0,f.jsx)("h3",{className:"text-sm font-semibold text-gray-700",children:"生成的代码"}),(0,f.jsxs)("div",{className:"flex space-x-2",children:[(0,f.jsxs)("button",{onClick:e,disabled:i||j||k,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed transition-colors duration-200 flex items-center gap-2",children:["清除",i&&(0,f.jsx)("div",{className:"w-3 h-3 border border-gray-400 border-t-transparent rounded-full animate-spin"})]}),(0,f.jsx)("button",{onClick:d,disabled:i||j||k||!a.trim(),className:"px-4 py-2 text-sm font-medium text-white rounded disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors duration-200 flex items-center gap-2",style:{background:i||j||k?"#d1d5db":"linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)"},title:"优化图标布局和箭头连接",children:k?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,f.jsx)("span",{children:"优化中..."})]}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("span",{children:"优化"}),i&&(0,f.jsx)("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"})]})}),(0,f.jsx)("button",{onClick:c,disabled:i||j||k||!a.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-gray-900 rounded hover:bg-gray-800 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors duration-200 flex items-center gap-2",children:j?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,f.jsx)("span",{children:"应用中..."})]}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("span",{children:"应用"}),(0,f.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"})}),i&&(0,f.jsx)("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"})]})})]})]}),g&&(0,f.jsxs)("div",{className:"absolute bottom-0 z-1 border-b border-red-200 px-4 py-3 flex items-start justify-between bg-white",children:[(0,f.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,f.jsx)("svg",{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:(0,f.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),(0,f.jsx)("div",{className:"flex-1",children:(0,f.jsx)("p",{className:"text-red-700 mt-1 font-mono",style:{fontSize:"12px"},children:g})})]}),(0,f.jsx)("button",{onClick:h,className:"text-red-600 hover:text-red-800 transition-colors ml-2",children:(0,f.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,f.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,f.jsx)("div",{className:"flex-1",children:(0,f.jsx)(ad,{height:"100%",defaultLanguage:"javascript",value:a,onChange:b,theme:"vs-light",options:{minimap:{enabled:!1},fontSize:13,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0,tabSize:2,wordWrap:"on"}})})]})}class af{constructor(){this.STORAGE_KEY="smart-excalidraw-configs",this.ACTIVE_CONFIG_KEY="smart-excalidraw-active-config",this.configs=[],this.activeConfigId=null,this.isLoaded=!1}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}ensureLoaded(){this.isLoaded||this.loadConfigs()}getActiveConfigId(){return this.ensureLoaded(),this.activeConfigId}loadConfigs(){}saveConfigs(){}saveActiveConfigId(){}createConfig(a){let b={id:this.generateId(),name:a.name||"新配置",type:a.type||"openai",baseUrl:a.baseUrl||"",apiKey:a.apiKey||"",model:a.model||"",description:a.description||"",isActive:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),...a};return this.configs.push(b),1===this.configs.length&&this.setActiveConfig(b.id),this.saveConfigs(),b}updateConfig(a,b){let c=this.configs.findIndex(b=>b.id===a);if(-1===c)throw Error("配置不存在");return this.configs[c]={...this.configs[c],...b,id:a,updatedAt:new Date().toISOString()},this.saveConfigs(),this.configs[c]}deleteConfig(a){let b=this.configs.findIndex(b=>b.id===a);if(-1===b)throw Error("配置不存在");if(this.activeConfigId===a)if(this.activeConfigId=null,this.configs.length>1){let b=this.configs.filter(b=>b.id!==a);this.activeConfigId=b[0].id,this.saveActiveConfigId()}else this.saveActiveConfigId();this.configs.splice(b,1),this.saveConfigs()}getAllConfigs(){return this.ensureLoaded(),[...this.configs]}getConfig(a){return this.ensureLoaded(),this.configs.find(b=>b.id===a)}getActiveConfig(){return(this.ensureLoaded(),this.activeConfigId)?this.getConfig(this.activeConfigId):null}setActiveConfig(a){let b=this.getConfig(a);if(!b)throw Error("配置不存在");return this.activeConfigId=a,this.saveActiveConfigId(),b}cloneConfig(a,b){this.ensureLoaded();let c=this.getConfig(a);if(!c)throw Error("原配置不存在");let d={...c,name:b||`${c.name} (副本)`,isActive:!1};return delete d.id,delete d.createdAt,delete d.updatedAt,this.createConfig(d)}validateConfig(a){let b=[];if(a.name&&""!==a.name.trim()||b.push("配置名称不能为空"),a.type&&["openai","anthropic"].includes(a.type)||b.push("配置类型必须是 openai 或 anthropic"),a.baseUrl&&""!==a.baseUrl.trim())try{new URL(a.baseUrl)}catch{b.push("API地址格式不正确")}else b.push("API地址不能为空");return a.apiKey&&""!==a.apiKey.trim()||b.push("API密钥不能为空"),a.model&&""!==a.model.trim()||b.push("模型名称不能为空"),{isValid:0===b.length,errors:b}}async testConnection(a){let b=this.validateConfig(a);if(!b.isValid)throw Error("配置无效: "+b.errors.join(", "));try{return{success:!0,message:"连接测试成功"}}catch(a){return{success:!1,message:a.message}}}importConfigs(a){try{let b=JSON.parse(a);if(!Array.isArray(b))throw Error("导入数据格式错误");let c=0;for(let a of b)this.validateConfig(a).isValid&&(this.createConfig({...a,isActive:!1}),c++);return{success:!0,count:c}}catch(a){return{success:!1,message:a.message}}}exportConfigs(){return JSON.stringify(this.configs,null,2)}searchConfigs(a){this.ensureLoaded();let b=a.toLowerCase();return this.configs.filter(a=>a.name.toLowerCase().includes(b)||a.description.toLowerCase().includes(b)||a.type.toLowerCase().includes(b))}getStats(){this.ensureLoaded();let a={total:this.configs.length,active:0,byType:{}};return this.configs.forEach(b=>{b.id===this.activeConfigId&&(a.active=1);let c=b.type;a.byType[c]=(a.byType[c]||0)+1}),a}}let ag=new af;function ah({isOpen:a,onClose:b,title:c,message:d,type:e="info",autoClose:g=!0,duration:h=3e3}){if(!a)return null;let i={success:{container:"bg-green-50 border-green-200",title:"text-green-800",message:"text-green-700",icon:"✓"},error:{container:"bg-red-50 border-red-200",title:"text-red-800",message:"text-red-700",icon:"✕"},warning:{container:"bg-yellow-50 border-yellow-200",title:"text-yellow-800",message:"text-yellow-700",icon:"⚠"},info:{container:"bg-blue-50 border-blue-200",title:"text-blue-800",message:"text-blue-700",icon:"ℹ"}},j=i[e]||i.info;return(0,f.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-20 px-4",children:[(0,f.jsx)("div",{className:"absolute inset-0 bg-black/25",onClick:b}),(0,f.jsx)("div",{className:"relative max-w-xs w-full min-w-0",children:(0,f.jsx)("div",{className:`border rounded-lg shadow-lg p-4 ${j.container}`,children:(0,f.jsxs)("div",{className:"flex items-start justify-between",children:[(0,f.jsxs)("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[(0,f.jsx)("span",{className:`text-xl ${j.title} flex-shrink-0`,children:j.icon}),(0,f.jsxs)("div",{className:"flex-1 min-w-0",children:[c&&(0,f.jsx)("h3",{className:`font-semibold text-xs ${j.title} break-words`,children:c}),d&&(0,f.jsx)("p",{className:`text-xs mt-1 whitespace-pre-wrap break-words ${j.message}`,children:d})]})]}),(0,f.jsx)("button",{onClick:b,className:`ml-4 text-gray-400 hover:text-gray-600 transition-colors ${j.title}`,children:(0,f.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})})]})}function ai({isOpen:a,onClose:b,title:c,children:d,maxWidth:e="max-w-2xl"}){return a?(0,f.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:b,children:(0,f.jsxs)("div",{className:`bg-white rounded-lg shadow-xl ${e} w-full max-h-[90vh] overflow-auto`,onClick:a=>a.stopPropagation(),children:[c&&(0,f.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,f.jsx)("h2",{className:"text-xl font-semibold",children:c}),(0,f.jsx)("button",{onClick:b,className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"关闭",children:(0,f.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,f.jsx)("div",{className:"p-6",children:d})]})}):null}function aj({size:a="md",color:b="white"}){return(0,f.jsx)("div",{className:`${{sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5",xl:"w-8 h-8"}[a]} ${{white:"border-white border-t-transparent",gray:"border-gray-700 border-t-transparent",primary:"border-gray-900 border-t-transparent"}[b]} border-2 rounded-full animate-spin`})}function ak({children:a,variant:b="primary",size:c="md",loading:d=!1,disabled:e=!1,onClick:g,type:h="button",className:i=""}){return(0,f.jsxs)("button",{type:h,onClick:g,disabled:e||d,className:`rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-gray-900 disabled:opacity-50 disabled:cursor-not-allowed ${{primary:"bg-gray-900 text-white hover:bg-gray-800 disabled:bg-gray-300",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200 border border-gray-300",danger:"bg-red-600 text-white hover:bg-red-700"}[b]} ${{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2",lg:"px-6 py-3 text-lg"}[c]} ${i} flex items-center justify-center gap-2`,children:[d&&(0,f.jsx)(aj,{size:"sm"===c?"sm":"md"}),a]})}function al({isOpen:a,onClose:b,onConfirm:c,title:d="确认操作",message:e,confirmText:g="确认",cancelText:h="取消",type:i="warning"}){let j={warning:{message:"text-yellow-700",variant:"primary"},danger:{message:"text-red-700",variant:"danger"},info:{message:"text-blue-700",variant:"primary"}},k=j[i]||j.warning;return(0,f.jsxs)(ai,{isOpen:a,onClose:b,title:d,maxWidth:"max-w-md",children:[(0,f.jsx)("p",{className:`text-sm ${k.message} mb-6`,children:e}),(0,f.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,f.jsx)(ak,{variant:"secondary",onClick:b,children:h}),(0,f.jsx)(ak,{variant:k.variant,onClick:c,children:g})]})]})}function am({isOpen:a,onClose:b,onConfigSelect:c}){let[d,e]=(0,g.useState)([]),[h,i]=(0,g.useState)(null),[j,k]=(0,g.useState)(null),[l,m]=(0,g.useState)(""),[n,o]=(0,g.useState)(!1),[p,q]=(0,g.useState)(!1),[r,s]=(0,g.useState)(""),[t,u]=(0,g.useState)({isOpen:!1,title:"",message:"",type:"info"}),[v,w]=(0,g.useState)({isOpen:!1,title:"",message:"",onConfirm:null}),x=()=>{try{let a=ag.getAllConfigs(),b=ag.getActiveConfigId();e(a),i(b)}catch(a){s("加载配置失败: "+a.message)}},y=async a=>{w({isOpen:!0,title:"确认删除",message:"确定要删除这个配置吗？此操作不可恢复。",onConfirm:async()=>{try{await ag.deleteConfig(a),x(),s(""),u({isOpen:!0,title:"删除成功",message:"配置已成功删除",type:"success"})}catch(a){s("删除配置失败: "+a.message)}}})},z=async a=>{try{await ag.setActiveConfig(a),x(),c?.(ag.getActiveConfig()),s("")}catch(a){s("切换配置失败: "+a.message)}},A=async a=>{q(!0),s("");try{let b=await ag.testConnection(a);b.success?u({isOpen:!0,title:"连接测试成功",message:b.message,type:"success"}):u({isOpen:!0,title:"连接测试失败",message:b.message,type:"error"})}catch(a){u({isOpen:!0,title:"连接测试失败",message:a.message,type:"error"})}finally{q(!1)}},B=l?ag.searchConfigs(l):d;return a?j?(0,f.jsx)(an,{config:j,isCreating:n,onSave:a=>{try{if(n){let b=ag.createConfig(a);0===d.length&&c?.(b)}else ag.updateConfig(j.id,a),j.id===h&&c?.(ag.getConfig(j.id));k(null),o(!1),x(),s("")}catch(a){s("保存配置失败: "+a.message)}},onCancel:()=>{k(null),o(!1)}}):(0,f.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,f.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:b}),(0,f.jsxs)("div",{className:"relative bg-white rounded border border-gray-300 w-full max-w-4xl mx-4 max-h-[90vh] overflow-hidden flex flex-col",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[(0,f.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"配置管理"}),(0,f.jsx)("button",{onClick:b,className:"text-gray-400 hover:text-gray-600 transition-colors duration-200",children:(0,f.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,f.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:[r&&(0,f.jsx)("div",{className:"mb-4 px-4 py-3 bg-red-50 border border-red-200 rounded",children:(0,f.jsx)("p",{className:"text-sm text-red-800",children:r})}),(0,f.jsx)("div",{className:"mb-4 px-4 py-3 bg-blue-50 border border-blue-200 rounded",children:(0,f.jsx)("p",{className:"text-sm text-blue-800",children:"提示：如果启用了访问密码，将优先使用服务器端配置，此处配置将被忽略"})}),(0,f.jsxs)("div",{className:"mb-6 flex flex-wrap gap-2",children:[(0,f.jsx)("button",{onClick:()=>{o(!0),k({name:"",type:"openai",baseUrl:"",apiKey:"",model:"",description:""})},className:"px-4 py-2 bg-gray-900 text-white rounded hover:bg-gray-800 transition-colors duration-200",children:"新建配置"}),(0,f.jsx)("button",{onClick:()=>{try{let a=ag.exportConfigs(),b=new Blob([a],{type:"application/json"}),c=URL.createObjectURL(b),d=document.createElement("a");d.href=c,d.download="llm-configs.json",d.click(),URL.revokeObjectURL(c)}catch(a){s("导出配置失败: "+a.message)}},className:"px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded hover:bg-gray-50 transition-colors duration-200",children:"导出配置"}),(0,f.jsx)("button",{onClick:()=>{let a=document.createElement("input");a.type="file",a.accept=".json",a.onchange=async a=>{let b=a.target.files[0];if(b)try{let a=await b.text(),c=ag.importConfigs(a);c.success?(u({isOpen:!0,title:"导入成功",message:`成功导入 ${c.count} 个配置`,type:"success"}),x()):s("导入配置失败: "+c.message)}catch(a){s("导入配置失败: "+a.message)}},a.click()},className:"px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded hover:bg-gray-50 transition-colors duration-200",children:"导入配置"})]}),(0,f.jsx)("div",{className:"mb-4",children:(0,f.jsx)("input",{type:"text",value:l,onChange:a=>m(a.target.value),placeholder:"搜索配置...",className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-900"})}),(0,f.jsx)("div",{className:"space-y-3",children:0===B.length?(0,f.jsx)("div",{className:"text-center py-8 text-gray-500",children:l?"没有找到匹配的配置":'暂无配置，点击"新建配置"创建第一个配置'}):B.map(a=>(0,f.jsx)("div",{className:`border rounded-lg p-4 ${a.id===h?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:(0,f.jsxs)("div",{className:"flex items-start justify-between",children:[(0,f.jsxs)("div",{className:"flex-1",children:[(0,f.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,f.jsx)("h3",{className:"font-medium text-gray-900",children:a.name}),a.id===h&&(0,f.jsx)("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded",children:"当前使用"}),(0,f.jsx)("span",{className:"px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded",children:a.type})]}),a.description&&(0,f.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:a.description}),(0,f.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[(0,f.jsxs)("div",{children:["URL: ",a.baseUrl]}),(0,f.jsxs)("div",{children:["模型: ",a.model]}),(0,f.jsxs)("div",{children:["创建时间: ",new Date(a.createdAt).toLocaleString()]})]})]}),(0,f.jsxs)("div",{className:"flex items-center gap-2 ml-4",children:[a.id!==h&&(0,f.jsx)("button",{onClick:()=>z(a.id),className:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors duration-200",children:"设为当前"}),(0,f.jsx)("button",{onClick:()=>A(a),disabled:p,className:"px-3 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600 transition-colors duration-200 disabled:bg-gray-400",children:"测试"}),(0,f.jsx)("button",{onClick:()=>{o(!1),k({...a})},className:"px-3 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors duration-200",children:"编辑"}),(0,f.jsx)("button",{onClick:()=>(a=>{let b=`${a.name} (副本)`;try{ag.cloneConfig(a.id,b),x(),s("")}catch(a){s("克隆配置失败: "+a.message)}})(a),className:"px-3 py-1 text-xs bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors duration-200",children:"克隆"}),d.length>1&&(0,f.jsx)("button",{onClick:()=>y(a.id),className:"px-3 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600 transition-colors duration-200",children:"删除"})]})]})},a.id))})]})]}),(0,f.jsx)(ah,{isOpen:t.isOpen,onClose:()=>u({...t,isOpen:!1}),title:t.title,message:t.message,type:t.type}),(0,f.jsx)(al,{isOpen:v.isOpen,onClose:()=>w({...v,isOpen:!1}),onConfirm:()=>{v.onConfirm?.(),w({...v,isOpen:!1})},title:v.title,message:v.message,type:"danger"})]}):null}function an({config:a,isCreating:b,onSave:c,onCancel:d}){let[e,h]=(0,g.useState)({...a}),[i,j]=(0,g.useState)([]),[k,l]=(0,g.useState)(!1),[m,n]=(0,g.useState)(!0),[o,p]=(0,g.useState)(""),q=async()=>{if(!e.type||!e.baseUrl||!e.apiKey)return void p("请先填写提供商类型、基础 URL 和 API 密钥");l(!0),p("");try{let a=new URLSearchParams({type:e.type,baseUrl:e.baseUrl,apiKey:e.apiKey}),b=await fetch(`/api/models?${a}`),c=await b.json();if(!b.ok)throw Error(c.error||"加载模型失败");j(c.models)}catch(a){p(a.message),j([])}finally{l(!1)}};return(0,f.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,f.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:d}),(0,f.jsxs)("div",{className:"relative bg-white rounded border border-gray-300 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[(0,f.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:b?"新建配置":"编辑配置"}),(0,f.jsx)("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 transition-colors duration-200",children:(0,f.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,f.jsxs)("div",{className:"px-6 py-4 space-y-4",children:[o&&(0,f.jsx)("div",{className:"px-4 py-3 bg-red-50 border border-red-200 rounded",children:(0,f.jsx)("p",{className:"text-sm text-red-800",children:o})}),(0,f.jsxs)("div",{children:[(0,f.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["配置名称 ",(0,f.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,f.jsx)("input",{type:"text",value:e.name,onChange:a=>h({...e,name:a.target.value}),placeholder:"例如：我的 OpenAI",className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-900"})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"描述"}),(0,f.jsx)("textarea",{value:e.description||"",onChange:a=>h({...e,description:a.target.value}),placeholder:"配置描述（可选）",rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-900"})]}),(0,f.jsxs)("div",{children:[(0,f.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["提供商类型 ",(0,f.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,f.jsxs)("select",{value:e.type,onChange:a=>h({...e,type:a.target.value,model:""}),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-900",children:[(0,f.jsx)("option",{value:"openai",children:"OpenAI"}),(0,f.jsx)("option",{value:"anthropic",children:"Anthropic"})]})]}),(0,f.jsxs)("div",{children:[(0,f.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["基础 URL ",(0,f.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,f.jsx)("input",{type:"text",value:e.baseUrl,onChange:a=>h({...e,baseUrl:a.target.value}),placeholder:"openai"===e.type?"https://api.openai.com/v1":"https://api.anthropic.com/v1",className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-900"})]}),(0,f.jsxs)("div",{children:[(0,f.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["API 密钥 ",(0,f.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,f.jsx)("input",{type:"password",value:e.apiKey,onChange:a=>h({...e,apiKey:a.target.value}),placeholder:"sk-...",className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-900"})]}),(0,f.jsx)("div",{children:(0,f.jsx)("button",{onClick:q,disabled:k,className:"w-full px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded hover:bg-gray-50 disabled:bg-gray-50 disabled:text-gray-400 transition-colors duration-200 font-medium",children:k?"加载模型中...":"加载可用模型"})}),(0,f.jsxs)("div",{children:[(0,f.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["模型 ",(0,f.jsx)("span",{className:"text-red-500",children:"*"})]}),i.length>0&&(0,f.jsxs)("div",{className:"mb-2 flex items-center space-x-4",children:[(0,f.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,f.jsx)("input",{type:"radio",checked:!m,onChange:()=>{n(!1),i.length>0&&h({...e,model:i[0].id})},className:"mr-2"}),(0,f.jsx)("span",{className:"text-sm text-gray-700",children:"从列表选择"})]}),(0,f.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,f.jsx)("input",{type:"radio",checked:m,onChange:()=>{n(!0),h({...e,model:""})},className:"mr-2"}),(0,f.jsx)("span",{className:"text-sm text-gray-700",children:"手动输入"})]})]}),i.length>0&&!m&&(0,f.jsx)("select",{value:e.model,onChange:a=>h({...e,model:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-900",children:i.map(a=>(0,f.jsx)("option",{value:a.id,children:a.name},a.id))}),(m||0===i.length)&&(0,f.jsx)("input",{type:"text",value:e.model,onChange:a=>h({...e,model:a.target.value}),placeholder:"例如：gpt-4、claude-3-opus-20240229",className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-900"})]})]}),(0,f.jsxs)("div",{className:"flex justify-end space-x-3 px-6 py-4 border-t border-gray-200",children:[(0,f.jsx)("button",{onClick:d,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded hover:bg-gray-50 transition-colors duration-200",children:"取消"}),(0,f.jsx)("button",{onClick:()=>{e.name&&e.type&&e.baseUrl&&e.apiKey&&e.model?c(e):p("请填写所有必填字段")},className:"px-4 py-2 text-white bg-gray-900 rounded hover:bg-gray-800 transition-colors duration-200",children:b?"创建":"保存"})]})]})]})}function ao({isOpen:a,onClose:b}){return(0,f.jsx)(ai,{isOpen:a,onClose:b,title:"联系作者",maxWidth:"max-w-sm",children:(0,f.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,f.jsx)("img",{src:"/qrcode.png",alt:"微信二维码",className:"w-48 rounded-lg",onError:a=>{a.target.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='192' height='192' viewBox='0 0 192 192'%3E%3Crect width='192' height='192' fill='%23f3f4f6'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' font-family='sans-serif' font-size='14' fill='%236b7280'%3E二维码暂未上传%3C/text%3E%3C/svg%3E"}}),(0,f.jsx)("p",{className:"text-gray-500 text-sm text-center",children:"扫描二维码，添加作者微信"})]})})}class ap{constructor(){this.STORAGE_KEY="smart-excalidraw-history",this.histories=[],this.loaded=!1}ensureLoaded(){}loadHistories(){try{let a=localStorage.getItem(this.STORAGE_KEY);this.histories=a?JSON.parse(a):[]}catch(a){console.error("Failed to load histories:",a),this.histories=[]}}saveHistories(){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.histories))}catch(a){console.error("Failed to save histories:",a)}}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}addHistory(a){this.ensureLoaded();let b={id:this.generateId(),chartType:a.chartType,userInput:a.userInput,generatedCode:a.generatedCode,config:a.config,timestamp:Date.now()};return this.histories.unshift(b),this.saveHistories(),b}getHistories(){return this.ensureLoaded(),[...this.histories]}deleteHistory(a){this.ensureLoaded(),this.histories=this.histories.filter(b=>b.id!==a),this.saveHistories()}clearAll(){this.ensureLoaded(),this.histories=[],this.saveHistories()}}let aq=new ap;function ar({isOpen:a,onClose:b,onApply:c}){let[d,e]=(0,g.useState)([]),[h,i]=(0,g.useState)({isOpen:!1,title:"",message:"",onConfirm:null}),j=()=>{e(aq.getHistories())};return a?(0,f.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,f.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:b}),(0,f.jsxs)("div",{className:"relative bg-white rounded border border-gray-300 w-full max-w-4xl mx-4 max-h-[90vh] overflow-hidden flex flex-col",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[(0,f.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"历史记录"}),(0,f.jsx)("button",{onClick:b,className:"text-gray-400 hover:text-gray-600 transition-colors duration-200",children:(0,f.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,f.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:[d.length>0&&(0,f.jsx)("div",{className:"mb-4",children:(0,f.jsx)("button",{onClick:()=>{i({isOpen:!0,title:"确认清空",message:"确定要清空所有历史记录吗？此操作不可恢复。",onConfirm:()=>{aq.clearAll(),j()}})},className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors duration-200",children:"清空全部"})}),(0,f.jsx)("div",{className:"space-y-3",children:0===d.length?(0,f.jsx)("div",{className:"text-center py-8 text-gray-500",children:"暂无历史记录"}):d.map(a=>(0,f.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-gray-300",children:(0,f.jsxs)("div",{className:"flex items-start justify-between",children:[(0,f.jsxs)("div",{className:"flex-1",children:[(0,f.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,f.jsx)("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded",children:m[a.chartType]||a.chartType}),(0,f.jsx)("span",{className:"text-xs text-gray-500",children:new Date(a.timestamp).toLocaleString()})]}),(0,f.jsx)("p",{className:"text-sm text-gray-900 mb-2",children:((a,b=100)=>a.length>b?a.substring(0,b)+"...":a)(a.userInput)}),a.config&&(0,f.jsxs)("div",{className:"text-xs text-gray-500",children:["模型: ",a.config.name," - ",a.config.model]})]}),(0,f.jsxs)("div",{className:"flex items-center gap-2 ml-4",children:[(0,f.jsx)("button",{onClick:()=>{c?.(a),b()},className:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors duration-200",children:"应用"}),(0,f.jsx)("button",{onClick:()=>{var b;return b=a.id,void i({isOpen:!0,title:"确认删除",message:"确定要删除这条历史记录吗？",onConfirm:()=>{aq.deleteHistory(b),j()}})},className:"px-3 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600 transition-colors duration-200",children:"删除"})]})]})},a.id))})]})]}),(0,f.jsx)(al,{isOpen:h.isOpen,onClose:()=>i({...h,isOpen:!1}),onConfirm:()=>{h.onConfirm?.(),i({...h,isOpen:!1})},title:h.title,message:h.message,type:"danger"})]}):null}function as({isOpen:a,onClose:b}){let[c,d]=(0,g.useState)(""),[e,h]=(0,g.useState)(!1),[i,j]=(0,g.useState)(!1),[k,l]=(0,g.useState)(""),[m,n]=(0,g.useState)(""),o=async()=>{if(!c){l("请输入访问密码"),n("error");return}j(!0),l("");try{let a=await fetch("/api/auth/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:c})}),b=await a.json();b.valid?(l("密码验证成功"),n("success")):(l(b.message||"密码验证失败"),n("error"))}catch(a){l("验证请求失败"),n("error")}finally{j(!1)}};return a?(0,f.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,f.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:b}),(0,f.jsxs)("div",{className:"relative bg-white rounded border border-gray-300 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[(0,f.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"访问密码设置"}),(0,f.jsx)("button",{onClick:b,className:"text-gray-400 hover:text-gray-600 transition-colors duration-200",children:(0,f.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,f.jsxs)("div",{className:"px-6 py-4 space-y-4",children:[k&&(0,f.jsx)("div",{className:`px-4 py-3 border rounded ${"success"===m?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:(0,f.jsx)("p",{className:`text-sm ${"success"===m?"text-green-800":"text-red-800"}`,children:k})}),(0,f.jsxs)("div",{className:"px-4 py-3 bg-blue-50 border border-blue-200 rounded",children:[(0,f.jsx)("p",{className:"text-sm text-blue-800 font-medium mb-1",children:"提示："}),(0,f.jsx)("p",{className:"text-sm text-blue-800",children:"• 访问密码优先级高于前端LLM配置"}),(0,f.jsx)("p",{className:"text-sm text-blue-800",children:"• 启用后将使用服务器端配置的LLM"})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"访问密码"}),(0,f.jsx)("input",{type:"password",value:c,onChange:a=>d(a.target.value),placeholder:"请输入访问密码",className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-900"})]}),(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,f.jsx)("input",{type:"checkbox",checked:e,onChange:a=>h(a.target.checked),className:"mr-2"}),(0,f.jsx)("span",{className:"text-sm text-gray-700",children:"启用访问密码"})]}),(0,f.jsx)("button",{onClick:o,disabled:i,className:"px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded hover:bg-gray-50 disabled:bg-gray-50 disabled:text-gray-400 transition-colors duration-200 font-medium",children:i?"验证中...":"验证密码"})]})]}),(0,f.jsxs)("div",{className:"flex justify-end space-x-3 px-6 py-4 border-t border-gray-200",children:[(0,f.jsx)("button",{onClick:b,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded hover:bg-gray-50 transition-colors duration-200",children:"取消"}),(0,f.jsx)("button",{onClick:()=>{l("设置已保存"),n("success"),setTimeout(()=>{b()},500)},className:"px-4 py-2 text-white bg-gray-900 rounded hover:bg-gray-800 transition-colors duration-200",children:"保存"})]})]})]}):null}function at(a){return!!a&&!!(a.type&&a.baseUrl&&a.apiKey&&a.model)}function au(a,b){let c,d,e=a.x||0,f=a.y||0,g=a.width||100,h=a.height||100,i=b.x||0,j=b.y||0,k=b.width||100,l=b.height||100,m=e+g/2-(i+k/2),n=f+h/2-(j+l/2),o=e-(i+k),p=-(e+g-i),q=f-(j+l),r=-(f+h-j);return m>0&&n>0?o>q?(c="left",d="right"):(c="top",d="bottom"):m<0&&n>0?p>q?(c="right",d="left"):(c="top",d="bottom"):m>0&&n<0?o>r?(c="left",d="right"):(c="bottom",d="top"):m<0&&n<0?p>r?(c="right",d="left"):(c="bottom",d="top"):0===m&&n>0?(c="top",d="bottom"):0===m&&n<0?(c="bottom",d="top"):m>0&&0===n?(c="left",d="right"):(c="right",d="left"),{startEdge:c,endEdge:d}}function av(a,b){let c=a.x||0,d=a.y||0,e=a.width||100,f=a.height||100;switch(b){case"left":return{x:c,y:d+f/2};case"right":default:return{x:c+e,y:d+f/2};case"top":return{x:c+e/2,y:d};case"bottom":return{x:c+e/2,y:d+f}}}function aw(a){if(!a||"string"!=typeof a)return a;try{let b=a.trim().match(/\[[\s\S]*\]/);if(!b)return console.error("No array found in code"),a;let c=JSON.parse(b[0]);if(!Array.isArray(c))return console.error("Parsed code is not an array"),a;let d=new Map;c.forEach(a=>{a.id&&d.set(a.id,a)});let e=c.map(a=>{if("arrow"!==a.type&&"line"!==a.type)return a;let b={...a},c=!1,e=a.start&&a.start.id?d.get(a.start.id):null,f=a.end&&a.end.id?d.get(a.end.id):null;if(e&&f){let a=function(a,b){let{startEdge:c}=au(a,b);return av(a,c)}(e,f);b.x=a.x,b.y=a.y;let d=function(a,b){let{endEdge:c}=au(b,a);return av(a,c)}(f,e);b.width=d.x-a.x,b.height=d.y-a.y,c=!0}return("arrow"===a.type||"line"===a.type)&&0===b.width&&(b.width=1,c=!0),c?b:a});return JSON.stringify(e,null,2)}catch(b){return console.error("Failed to optimize arrows:",b),a}}let ax=i()(async()=>{},{loadableGenerated:{modules:["app/page.js -> @/components/ExcalidrawCanvas"]},ssr:!1});function ay(){let[a,b]=(0,g.useState)(null),[c,d]=(0,g.useState)(!1),[e,h]=(0,g.useState)(!1),[i,j]=(0,g.useState)(!1),[k,l]=(0,g.useState)(!1),[m,n]=(0,g.useState)(""),[o,q]=(0,g.useState)([]),[r,s]=(0,g.useState)(!1),[t,u]=(0,g.useState)(!1),[v,w]=(0,g.useState)(!1),[x,y]=(0,g.useState)(25),[z,A]=(0,g.useState)(!1),[B,C]=(0,g.useState)(null),[D,E]=(0,g.useState)(null),[F,G]=(0,g.useState)(""),[H,I]=(0,g.useState)("auto"),[J,K]=(0,g.useState)(!1),[L,M]=(0,g.useState)({isOpen:!1,title:"",message:"",type:"info"}),N=a=>{if(!a||"string"!=typeof a)return a;let b=a.trim();b=(b=(b=b.replace(/^```(?:json|javascript|js)?\s*\n?/i,"")).replace(/\n?```\s*$/,"")).trim();try{return JSON.parse(b),b}catch(a){return O(b)}},O=a=>{let b="",c=!1,d=!1;for(let e=0;e<a.length;e++){let f=a[e];if(e>0&&a[e-1],d){b+=f,d=!1;continue}if("\\"===f){b+=f,d=!0;continue}if('"'===f)if(c){let d=a.slice(e+1).match(/^\s*(.)/),g=d?d[1]:"";":"===g||","===g||"}"===g||"]"===g||""===g?(c=!1,b+=f):b+='\\"'}else c=!0,b+=f;else b+=f}return b},P=async(b,c="auto")=>{if(!at(a)){M({isOpen:!0,title:"配置提醒",message:"请先配置您的 LLM 提供商或启用访问密码",type:"warning"}),d(!0);return}G(b),I(c),s(!0),C(null),E(null);try{let d=await fetch("/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({config:a,userInput:b,chartType:c})});if(!d.ok){let a="生成代码失败";try{let b=await d.json();b.error&&(a=b.error)}catch(b){switch(d.status){case 400:a="请求参数错误，请检查输入内容";break;case 401:case 403:a="API 密钥无效或权限不足，请检查配置";break;case 429:a="请求过于频繁，请稍后再试";break;case 500:case 502:case 503:a="服务器错误，请稍后重试";break;default:a=`请求失败 (${d.status})`}}throw Error(a)}let e=d.body.getReader(),f=new TextDecoder,g="",h="";for(;;){let{done:a,value:b}=await e.read();if(a)break;let c=(h+=f.decode(b,{stream:!0})).split("\n");for(let a of(h=c.pop()||"",c))if(""!==a.trim()&&"data: [DONE]"!==a.trim()&&a.startsWith("data: "))try{let b=JSON.parse(a.slice(6));if(b.content){g+=b.content;let a=N(g);n(a)}else if(b.error)throw Error(b.error)}catch(a){a.message&&!a.message.includes("Unexpected")&&C("数据流解析错误："+a.message),console.error("Failed to parse SSE:",a)}}let i=N(g);Q(i);let j=aw(i);n(j),Q(j),b&&j&&aq.addHistory({chartType:c,userInput:b,generatedCode:j,config:{name:a.name||a.type,model:a.model}})}catch(a){console.error("Error generating code:",a),"Failed to fetch"===a.message||"TypeError"===a.name?C("网络连接失败，请检查网络连接"):C(a.message)}finally{s(!1)}},Q=a=>{try{E(null);let b=a.trim().match(/\[[\s\S]*\]/);if(!b){E("代码中未找到有效的 JSON 数组"),console.error("No array found in generated code");return}let c=JSON.parse(b[0]);Array.isArray(c)&&(q(c),E(null))}catch(a){console.error("Failed to parse generated code:",a),a instanceof SyntaxError?E("JSON 语法错误："+a.message):E("解析失败："+a.message)}},R=async()=>{u(!0);try{await new Promise(a=>setTimeout(a,300)),Q(m)}catch(a){console.error("Error applying code:",a)}finally{u(!1)}},S=async()=>{w(!0);try{await new Promise(a=>setTimeout(a,500));let a=aw(m);n(a),Q(a)}catch(a){console.error("Error optimizing code:",a)}finally{w(!1)}};return(0,f.jsxs)("div",{className:"flex flex-col h-screen bg-gray-50",children:[(0,f.jsxs)("header",{className:"flex items-center justify-between px-6 h-[50px] bg-white border-b border-gray-200",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("h1",{className:"text-lg leading-tight font-semibold text-gray-900",children:"Smart Excalidraw"}),(0,f.jsx)("p",{className:"text-xs leading-tight text-gray-500",children:"AI 驱动的图表生成"})]}),(0,f.jsxs)("div",{className:"flex items-center space-x-3",children:[(J||a&&at(a))&&(0,f.jsxs)("div",{className:"flex items-center space-x-2 px-3 py-1.5 bg-green-50 rounded border border-green-300",children:[(0,f.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,f.jsx)("span",{className:"text-xs text-green-900 font-medium",children:J?"密码访问":`${a.name||a.type} - ${a.model}`})]}),(0,f.jsxs)("a",{href:"https://github.com/liujuntao123/smart-excalidraw-next",target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-1 text-gray-600 hover:text-gray-900 transition-colors","aria-label":"GitHub 仓库",children:[(0,f.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{fillRule:"evenodd",d:"M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z",clipRule:"evenodd"})}),(0,f.jsx)("span",{className:"text-sm",children:"GitHub"})]}),(0,f.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,f.jsx)("button",{onClick:()=>j(!0),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded hover:bg-gray-50 transition-colors duration-200",children:"历史记录"}),(0,f.jsx)("button",{onClick:()=>l(!0),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded hover:bg-gray-50 transition-colors duration-200",children:"访问密码"}),(0,f.jsx)("button",{onClick:()=>d(!0),className:"px-4 py-2 text-sm font-medium text-white bg-gray-900 border border-gray-900 rounded hover:bg-gray-800 transition-colors duration-200",children:"管理配置"})]})]})]}),(0,f.jsxs)("div",{className:"flex flex-1 overflow-hidden pb-1",children:[(0,f.jsxs)("div",{id:"left-panel",style:{width:`${x}%`},className:"flex flex-col border-r border-gray-200 bg-white",children:[B&&(0,f.jsxs)("div",{className:"bg-red-50 border-b border-red-200 px-4 py-3 flex items-start justify-between",children:[(0,f.jsxs)("div",{className:"flex items-start space-x-2 min-w-0 flex-1",children:[(0,f.jsx)("svg",{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:(0,f.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),(0,f.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,f.jsx)("p",{className:"text-xs font-medium text-red-800",children:"请求失败"}),(0,f.jsx)("p",{className:"text-xs text-red-700 mt-1 break-words",children:B})]})]}),(0,f.jsx)("button",{onClick:()=>C(null),className:"text-red-600 hover:text-red-800 transition-colors",children:(0,f.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,f.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,f.jsx)("div",{style:{height:"50%"},className:"overflow-auto",children:(0,f.jsx)(p,{onSendMessage:P,isGenerating:r,initialInput:F,initialChartType:H})}),(0,f.jsx)("div",{style:{height:"50%"},className:"overflow-hidden",children:(0,f.jsx)(ae,{code:m,onChange:n,onApply:R,onOptimize:S,onClear:()=>{n("")},jsonError:D,onClearJsonError:()=>E(null),isGenerating:r,isApplyingCode:t,isOptimizingCode:v})})]}),(0,f.jsx)("div",{onMouseDown:a=>{A(!0),a.preventDefault()},className:"w-1 bg-gray-200 hover:bg-gray-400 cursor-col-resize transition-colors duration-200 flex-shrink-0"}),(0,f.jsx)("div",{style:{width:`${100-x}%`},className:"bg-gray-50",children:(0,f.jsx)(ax,{elements:o})})]}),(0,f.jsx)(am,{isOpen:c,onClose:()=>d(!1),onConfigSelect:a=>{a&&b(a)}}),(0,f.jsx)(ar,{isOpen:i,onClose:()=>j(!1),onApply:a=>{G(a.userInput),I(a.chartType),n(a.generatedCode),Q(a.generatedCode)}}),(0,f.jsx)(as,{isOpen:k,onClose:()=>l(!1)}),(0,f.jsx)(ao,{isOpen:e,onClose:()=>h(!1)}),(0,f.jsx)(ah,{isOpen:L.isOpen,onClose:()=>M({...L,isOpen:!1}),title:L.title,message:L.message,type:L.type})]})}},6055:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>e});var d=c(8868);let e=async a=>[{type:"image/x-icon",sizes:"16x16",url:(0,d.fillMetadataSegment)(".",await a.params,"favicon.ico")+"?603d046c9a6fdfbb"}]},6439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},6487:()=>{},6713:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/is-bot")},6958:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"BailoutToCSR",{enumerable:!0,get:function(){return e}});let d=c(9306);function e({reason:a,children:b}){throw Object.defineProperty(new d.BailoutToCSRError(a),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})}},7596:()=>{},7868:()=>{},7974:(a,b,c)=>{"use strict";c.r(b),c.d(b,{GlobalError:()=>D.a,__next_app__:()=>L,handler:()=>N,routeModule:()=>M});var d=c(7553),e=c(4006),f=c(7798),g=c(4775),h=c(9373),i=c(3461),j=c(1020),k=c(6349),l=c(4365),m=c(6023),n=c(3747),o=c(8564),p=c(3938),q=c(8575),r=c(261),s=c(6758),t=c(7243),u=c(6713),v=c(7527),w=c(2820),x=c(8216),y=c(7929),z=c(9551),A=c(9125),B=c(6439),C=c(5547),D=c.n(C),E=c(1287),F=c(1494),G=c(722),H=c(753),I=c(3954),J={};for(let a in E)0>["default","GlobalError","__next_app__","routeModule","handler"].indexOf(a)&&(J[a]=()=>E[a]);c.d(b,J);let K={children:["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(c.bind(c,5151)),"/Users/rongfahuang/flyapp/smart-excalidraw-next/app/page.js"],metadata:{icon:[async a=>(await Promise.resolve().then(c.bind(c,6055))).default(a)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(c.bind(c,9450)),"/Users/rongfahuang/flyapp/smart-excalidraw-next/app/layout.js"],"global-error":[()=>Promise.resolve().then(c.t.bind(c,5547,23)),"next/dist/client/components/builtin/global-error.js"],"not-found":[()=>Promise.resolve().then(c.t.bind(c,5091,23)),"next/dist/client/components/builtin/not-found.js"],forbidden:[()=>Promise.resolve().then(c.t.bind(c,5270,23)),"next/dist/client/components/builtin/forbidden.js"],unauthorized:[()=>Promise.resolve().then(c.t.bind(c,8193,23)),"next/dist/client/components/builtin/unauthorized.js"],metadata:{icon:[async a=>(await Promise.resolve().then(c.bind(c,6055))).default(a)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,L={require:c,loadChunk:()=>Promise.resolve()},M=new d.AppPageRouteModule({definition:{kind:e.RouteKind.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:K},distDir:".next",relativeProjectDir:""});async function N(a,b,d){var C;M.isDev&&(0,h.addRequestMeta)(a,"devRequestTimingInternalsEnd",process.hrtime.bigint());let J="/page";"/index"===J&&(J="/");let O=!!(0,h.getRequestMeta)(a,"minimalMode"),P=await M.prepare(a,b,{srcPage:J,multiZoneDraftMode:!1});if(!P)return b.statusCode=400,b.end("Bad Request"),null==d.waitUntil||d.waitUntil.call(d,Promise.resolve()),null;let{buildId:Q,query:R,params:S,pageIsDynamic:T,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,serverActionsManifest:X,clientReferenceManifest:Y,subresourceIntegrityManifest:Z,prerenderManifest:$,isDraftMode:_,resolvedPathname:aa,revalidateOnlyGenerated:ab,routerServerContext:ac,nextConfig:ad,parsedUrl:ae,interceptionRoutePatterns:af}=P,ag=(0,r.normalizeAppPath)(J),{isOnDemandRevalidate:ah}=P,ai=ad.experimental.ppr&&!ad.cacheComponents&&(0,I.isInterceptionRouteAppPath)(aa)?null:M.match(aa,$),aj=!!$.routes[aa],ak=a.headers["user-agent"]||"",al=(0,u.getBotType)(ak),am=(0,p.isHtmlBotRequest)(a),an=(0,h.getRequestMeta)(a,"isPrefetchRSCRequest")??"1"===a.headers[t.NEXT_ROUTER_PREFETCH_HEADER],ao=(0,h.getRequestMeta)(a,"isRSCRequest")??!!a.headers[t.RSC_HEADER],ap=(0,s.getIsPossibleServerAction)(a),aq=(0,m.checkIsAppPPREnabled)(ad.experimental.ppr)&&(null==(C=$.routes[ag]??$.dynamicRoutes[ag])?void 0:C.renderingMode)==="PARTIALLY_STATIC",ar=!1,as=!1,at=aq?(0,h.getRequestMeta)(a,"postponed"):void 0,au=aq&&ao&&!an,av=(0,h.getRequestMeta)(a,"segmentPrefetchRSCRequest"),aw=(!am||!aq)&&(!ak||(0,p.shouldServeStreamingMetadata)(ak,ad.htmlLimitedBots)),ax=!!((ai||aj||$.routes[ag])&&!(am&&aq)),ay=aq&&!0===ad.cacheComponents,az=!0===M.isDev||!ax||"string"==typeof at||(ay&&(0,h.getRequestMeta)(a,"onCacheEntryV2")?au&&!O:au),aA=am&&aq,aB=null;_||!ax||az||ap||at||au||(aB=aa);let aC=aB;!aC&&M.isDev&&(aC=aa),M.isDev||_||!ax||!ao||au||(0,k.d)(a.headers);let aD={...E,tree:K,GlobalError:D(),handler:N,routeModule:M,__next_app__:L};X&&Y&&(0,o.setReferenceManifestsSingleton)({page:J,clientReferenceManifest:Y,serverActionsManifest:X,serverModuleMap:(0,q.createServerModuleMap)({serverActionsManifest:X})});let aE=a.method||"GET",aF=(0,g.getTracer)(),aG=aF.getActiveScopeSpan(),aH=async()=>((null==ac?void 0:ac.render404)?await ac.render404(a,b,ae,!1):b.end("This page could not be found"),null);try{let f=M.getVaryHeader(aa,af);b.setHeader("Vary",f);let k=async(c,d)=>{let e=new l.NodeNextRequest(a),f=new l.NodeNextResponse(b);return M.render(e,f,d).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let a=aF.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==i.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let d=a.get("next.route");if(d){let a=`${aE} ${d}`;c.setAttributes({"next.route":d,"http.route":d,"next.span_name":a}),c.updateName(a)}else c.updateName(`${aE} ${J}`)})},m=(0,h.getRequestMeta)(a,"incrementalCache"),o=async({span:e,postponed:f,fallbackRouteParams:g,forceStaticRender:i})=>{let l={query:R,params:S,page:ag,sharedContext:{buildId:Q},serverComponentsHmrCache:(0,h.getRequestMeta)(a,"serverComponentsHmrCache"),fallbackRouteParams:g,renderOpts:{App:()=>null,Document:()=>null,pageConfig:{},ComponentMod:aD,Component:(0,j.T)(aD),params:S,routeModule:M,page:J,postponed:f,shouldWaitOnAllReady:aA,serveStreamingMetadata:aw,supportsDynamicResponse:"string"==typeof f||az,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,subresourceIntegrityManifest:Z,serverActionsManifest:X,clientReferenceManifest:Y,setCacheStatus:null==ac?void 0:ac.setCacheStatus,setIsrStatus:null==ac?void 0:ac.setIsrStatus,setReactDebugChannel:null==ac?void 0:ac.setReactDebugChannel,dir:c(3873).join(process.cwd(),M.relativeProjectDir),isDraftMode:_,botType:al,isOnDemandRevalidate:ah,isPossibleServerAction:ap,assetPrefix:ad.assetPrefix,nextConfigOutput:ad.output,crossOrigin:ad.crossOrigin,trailingSlash:ad.trailingSlash,images:ad.images,previewProps:$.preview,deploymentId:ad.deploymentId,enableTainting:ad.experimental.taint,htmlLimitedBots:ad.htmlLimitedBots,reactMaxHeadersLength:ad.reactMaxHeadersLength,multiZoneDraftMode:!1,incrementalCache:m,cacheLifeProfiles:ad.cacheLife,basePath:ad.basePath,serverActions:ad.experimental.serverActions,...ar||as?{nextExport:!0,supportsDynamicResponse:!1,isStaticGeneration:!0,isDebugDynamicAccesses:ar}:{},cacheComponents:!!ad.cacheComponents,experimental:{isRoutePPREnabled:aq,expireTime:ad.expireTime,staleTimes:ad.experimental.staleTimes,clientSegmentCache:!!ad.experimental.clientSegmentCache,dynamicOnHover:!!ad.experimental.dynamicOnHover,inlineCss:!!ad.experimental.inlineCss,authInterrupts:!!ad.experimental.authInterrupts,clientTraceMetadata:ad.experimental.clientTraceMetadata||[],clientParamParsingOrigins:ad.experimental.clientParamParsingOrigins},waitUntil:d.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:()=>{},onInstrumentationRequestError:(b,c,d)=>M.onRequestError(a,b,d,ac),err:(0,h.getRequestMeta)(a,"invokeError"),dev:M.isDev}};ar&&(l.renderOpts.nextExport=!0,l.renderOpts.supportsDynamicResponse=!1,l.renderOpts.isDebugDynamicAccesses=ar),i&&(l.renderOpts.supportsDynamicResponse=!1);let n=await k(e,l),{metadata:o}=n,{cacheControl:p,headers:q={},fetchTags:r,fetchMetrics:s}=o;if(r&&(q[y.NEXT_CACHE_TAGS_HEADER]=r),a.fetchMetrics=s,ax&&(null==p?void 0:p.revalidate)===0&&!M.isDev&&!aq){let a=o.staticBailoutInfo,b=Object.defineProperty(Error(`Page changed from static to dynamic at runtime ${aa}${(null==a?void 0:a.description)?`, reason: ${a.description}`:""}
see more here https://nextjs.org/docs/messages/app-static-to-dynamic-error`),"__NEXT_ERROR_CODE",{value:"E132",enumerable:!1,configurable:!0});if(null==a?void 0:a.stack){let c=a.stack;b.stack=b.message+c.substring(c.indexOf("\n"))}throw b}return{value:{kind:v.CachedRouteKind.APP_PAGE,html:n,headers:q,rscData:o.flightData,postponed:o.postponed,status:o.statusCode,segmentData:o.segmentData},cacheControl:p}},p=async({hasResolved:c,previousCacheEntry:f,isRevalidating:g,span:i,forceStaticRender:j=!1})=>{let k,l=!1===M.isDev,q=c||b.writableEnded;if(ah&&ab&&!f&&!O)return(null==ac?void 0:ac.render404)?await ac.render404(a,b):(b.statusCode=404,b.end("This page could not be found")),null;if(ai&&(k=(0,w.parseFallbackField)(ai.fallback)),k===w.FallbackMode.PRERENDER&&(0,u.isBot)(ak)&&(!aq||am)&&(k=w.FallbackMode.BLOCKING_STATIC_RENDER),(null==f?void 0:f.isStale)===-1&&(ah=!0),ah&&(k!==w.FallbackMode.NOT_FOUND||f)&&(k=w.FallbackMode.BLOCKING_STATIC_RENDER),!O&&k!==w.FallbackMode.BLOCKING_STATIC_RENDER&&aC&&!q&&!_&&T&&(l||!aj)){if((l||ai)&&k===w.FallbackMode.NOT_FOUND){if(ad.experimental.adapterPath)return await aH();throw new B.NoFallbackError}if(aq&&(ad.cacheComponents?!au:!ao)){let b=l&&"string"==typeof(null==ai?void 0:ai.fallback)?ai.fallback:ag,c=l&&(null==ai?void 0:ai.fallbackRouteParams)?(0,n.createOpaqueFallbackRouteParams)(ai.fallbackRouteParams):as?(0,n.getFallbackRouteParams)(ag,M):null,f=await M.handleResponse({cacheKey:b,req:a,nextConfig:ad,routeKind:e.RouteKind.APP_PAGE,isFallback:!0,prerenderManifest:$,isRoutePPREnabled:aq,responseGenerator:async()=>o({span:i,postponed:void 0,fallbackRouteParams:c,forceStaticRender:!1}),waitUntil:d.waitUntil,isMinimalMode:O});if(null===f)return null;if(f)return delete f.cacheControl,f}}let r=ah||g||!at?void 0:at;if(ay&&!O&&m&&au&&!j){let b=await m.get(aa,{kind:v.IncrementalCacheKind.APP_PAGE,isRoutePPREnabled:!0,isFallback:!1});b&&b.value&&b.value.kind===v.CachedRouteKind.APP_PAGE&&(r=b.value.postponed,b&&(-1===b.isStale||!0===b.isStale)&&(0,H.scheduleOnNextTick)(async()=>{let b=M.getResponseCache(a);try{await b.revalidate(aa,m,aq,!1,a=>p({...a,forceStaticRender:!0}),null,c,d.waitUntil)}catch(a){console.error("Error revalidating the page in the background",a)}}))}if(ar&&void 0!==r)return{cacheControl:{revalidate:1,expire:void 0},value:{kind:v.CachedRouteKind.PAGES,html:x.default.EMPTY,pageData:{},headers:void 0,status:void 0}};let s=l&&(null==ai?void 0:ai.fallbackRouteParams)&&(0,h.getRequestMeta)(a,"renderFallbackShell")?(0,n.createOpaqueFallbackRouteParams)(ai.fallbackRouteParams):as?(0,n.getFallbackRouteParams)(ag,M):null;return o({span:i,postponed:r,fallbackRouteParams:s,forceStaticRender:j})},q=async c=>{var f,g,i,j,k;let l,m=await M.handleResponse({cacheKey:aB,responseGenerator:a=>p({span:c,...a}),routeKind:e.RouteKind.APP_PAGE,isOnDemandRevalidate:ah,isRoutePPREnabled:aq,req:a,nextConfig:ad,prerenderManifest:$,waitUntil:d.waitUntil,isMinimalMode:O});if(_&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate"),M.isDev&&b.setHeader("Cache-Control","no-store, must-revalidate"),!m){if(aB)throw Object.defineProperty(Error("invariant: cache entry required but not generated"),"__NEXT_ERROR_CODE",{value:"E62",enumerable:!1,configurable:!0});return null}if((null==(f=m.value)?void 0:f.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant app-page handler received invalid cache entry ${null==(i=m.value)?void 0:i.kind}`),"__NEXT_ERROR_CODE",{value:"E707",enumerable:!1,configurable:!0});let n="string"==typeof m.value.postponed;ax&&!au&&(!n||an)&&(O||b.setHeader("x-nextjs-cache",ah?"REVALIDATED":m.isMiss?"MISS":m.isStale?"STALE":"HIT"),b.setHeader(t.NEXT_IS_PRERENDER_HEADER,"1"));let{value:q}=m;if(at)l={revalidate:0,expire:void 0};else if(au)l={revalidate:0,expire:void 0};else if(!M.isDev)if(_)l={revalidate:0,expire:void 0};else if(ax){if(m.cacheControl)if("number"==typeof m.cacheControl.revalidate){if(m.cacheControl.revalidate<1)throw Object.defineProperty(Error(`Invalid revalidate configuration provided: ${m.cacheControl.revalidate} < 1`),"__NEXT_ERROR_CODE",{value:"E22",enumerable:!1,configurable:!0});l={revalidate:m.cacheControl.revalidate,expire:(null==(j=m.cacheControl)?void 0:j.expire)??ad.expireTime}}else l={revalidate:y.CACHE_ONE_YEAR,expire:void 0}}else b.getHeader("Cache-Control")||(l={revalidate:0,expire:void 0});if(m.cacheControl=l,"string"==typeof av&&(null==q?void 0:q.kind)===v.CachedRouteKind.APP_PAGE&&q.segmentData){b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"2");let c=null==(k=q.headers)?void 0:k[y.NEXT_CACHE_TAGS_HEADER];O&&ax&&c&&"string"==typeof c&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,c);let d=q.segmentData.get(av);return void 0!==d?(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(d,t.RSC_CONTENT_TYPE_HEADER),cacheControl:m.cacheControl}):(b.statusCode=204,(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.EMPTY,cacheControl:m.cacheControl}))}let r=ay?(0,h.getRequestMeta)(a,"onCacheEntryV2")??(0,h.getRequestMeta)(a,"onCacheEntry"):(0,h.getRequestMeta)(a,"onCacheEntry");if(r&&await r(m,{url:(0,h.getRequestMeta)(a,"initURL")??a.url}))return null;if(q.headers){let a={...q.headers};for(let[c,d]of(O&&ax||delete a[y.NEXT_CACHE_TAGS_HEADER],Object.entries(a)))if(void 0!==d)if(Array.isArray(d))for(let a of d)b.appendHeader(c,a);else"number"==typeof d&&(d=d.toString()),b.appendHeader(c,d)}let s=null==(g=q.headers)?void 0:g[y.NEXT_CACHE_TAGS_HEADER];if(O&&ax&&s&&"string"==typeof s&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,s),!q.status||ao&&aq||(b.statusCode=q.status),!O&&q.status&&F.RedirectStatusCode[q.status]&&ao&&(b.statusCode=200),n&&!au&&b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"1"),ao&&!_){if(void 0===q.rscData){if(q.html.contentType!==t.RSC_CONTENT_TYPE_HEADER)if(ad.cacheComponents)return b.statusCode=404,(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.EMPTY,cacheControl:m.cacheControl});else throw Object.defineProperty(new G.InvariantError(`Expected RSC response, got ${q.html.contentType}`),"__NEXT_ERROR_CODE",{value:"E789",enumerable:!1,configurable:!0});return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:q.html,cacheControl:m.cacheControl})}return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(q.rscData,t.RSC_CONTENT_TYPE_HEADER),cacheControl:m.cacheControl})}let u=q.html;if(!n||O||ao)return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:m.cacheControl});if(ar)return u.push(new ReadableStream({start(a){a.enqueue(z.ENCODED_TAGS.CLOSED.BODY_AND_HTML),a.close()}})),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}});let w=new TransformStream;return u.push(w.readable),o({span:c,postponed:q.postponed,fallbackRouteParams:null,forceStaticRender:!1}).then(async a=>{var b,c;if(!a)throw Object.defineProperty(Error("Invariant: expected a result to be returned"),"__NEXT_ERROR_CODE",{value:"E463",enumerable:!1,configurable:!0});if((null==(b=a.value)?void 0:b.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant: expected a page response, got ${null==(c=a.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E305",enumerable:!1,configurable:!0});await a.value.html.pipeTo(w.writable)}).catch(a=>{w.writable.abort(a).catch(a=>{console.error("couldn't abort transformer",a)})}),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}})};if(!aG)return await aF.withPropagatedContext(a.headers,()=>aF.trace(i.BaseServerSpan.handleRequest,{spanName:`${aE} ${J}`,kind:g.SpanKind.SERVER,attributes:{"http.method":aE,"http.target":a.url}},q));await q(aG)}catch(b){throw b instanceof B.NoFallbackError||await M.onRequestError(a,b,{routerKind:"App Router",routePath:J,routeType:"render",revalidateReason:(0,f.c)({isStaticGeneration:ax,isOnDemandRevalidate:ah})},ac),b}}},7975:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,1921,23))},8039:(a,b,c)=>{Promise.resolve().then(c.bind(c,5708))},8143:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,5547,23))},8335:()=>{},8354:a=>{"use strict";a.exports=require("util")},9121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9450:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>j,metadata:()=>i});var d=c(5735),e=c(2123),f=c.n(e),g=c(4607),h=c.n(g);c(2704);let i={title:"Smart Excalidraw",description:"AI 驱动的图表生成"};function j({children:a}){return(0,d.jsx)("html",{lang:"zh-CN",children:(0,d.jsx)("body",{className:`${f().variable} ${h().variable} antialiased`,children:a})})}},9791:(a,b,c)=>{Promise.resolve().then(c.bind(c,5151))},9973:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"default",{enumerable:!0,get:function(){return e}});let d=c(399)._(c(61));function e(a,b){let c={};"function"==typeof a&&(c.loader=a);let e={...c,...b};return(0,d.default)({...e,modules:e.loadableGenerated?.modules})}("function"==typeof b.default||"object"==typeof b.default&&null!==b.default)&&void 0===b.default.__esModule&&(Object.defineProperty(b.default,"__esModule",{value:!0}),Object.assign(b.default,b),a.exports=b.default)}};var b=require("../webpack-runtime.js");b.C(a);var c=b.X(0,[134,286],()=>b(b.s=7974));module.exports=c})();